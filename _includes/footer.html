<footer>
  <hr class="slender">
  <ul class="footer-links">
    <li><a href="mailto:dsjoholm22@gmail.com"><span class="icon-mail3"></span></a></li>    
    {% for entry in site.data.social %}
      <li>
        <a href="{{ entry.link }}"><span class="{{ entry.icon }}"></span></a>
      </li>
    {% endfor %}  
  </ul>
<div class="credits">
<span>&copy; {{ site.time | date: '%Y' }} &nbsp;&nbsp;{{site.author | upcase }}</span></br> <br>
<span>This site created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme for {{site.subtitle}} </a> in <a href="//jekyllrb.com">Jekyll</a>.</span> 
</div>  
</footer>

<script>
  const toggle = document.getElementById('dark-mode-toggle');
  const body = document.body;

  // Check for saved preference
  if (localStorage.getItem('theme') === 'dark') {
    body.classList.add('dark-mode');
  }

  toggle.addEventListener('click', () => {
    body.classList.toggle('dark-mode');
    // Save preference
    if (body.classList.contains('dark-mode')) {
      localStorage.setItem('theme', 'dark');
    } else {
      localStorage.setItem('theme', 'light');
    }
  });
</script>


<!-- Link popping up -->



<div id="link-preview"></div>

<script>
const previewBox = document.getElementById('link-preview');
const internalLinks = document.querySelectorAll('article a:not([href^="http"])');

internalLinks.forEach(link => {
  link.addEventListener('mouseenter', async (e) => {
    const url = link.getAttribute('href');
    
    // Position the box near the mouse
    previewBox.style.left = e.pageX + 10 + 'px';
    previewBox.style.top = e.pageY + 10 + 'px';
    previewBox.style.visibility = 'visible';
    previewBox.style.opacity = '1';

    try {
      const response = await fetch(url);
      const text = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      
      const title = doc.querySelector('title').innerText.split('|')[0];
      const snippet = doc.querySelector('p').innerText.substring(0, 100) + '...';

      previewBox.innerHTML = `<h3>${title}</h3><p>${snippet}</p>`;
    } catch (err) {
      previewBox.innerHTML = `<p>Loading preview...</p>`;
    }
  });

  link.addEventListener('mouseleave', () => {
    previewBox.style.visibility = 'hidden';
    previewBox.style.opacity = '0';
  });
});
</script>


<!-- For the favicon thing -->
<script>
  // Find all links starting with http (external)
  const links = document.querySelectorAll('article a[href^="http"]');

  links.forEach(link => {
    // Create a new image element
    const img = document.createElement('img');
    
    // Get the domain from the link (e.g., google.com)
    const domain = new URL(link.href).hostname;
    
    // Set the source to Google's favicon service
    img.src = `https://www.google.com/s2/favicons?sz=64&domain=${domain}`;
    img.classList.add('external-favicon');
    
    // Append the image to the end of the link
    link.appendChild(img);
  });
</script>
